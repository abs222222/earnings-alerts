{
  "version": "3.0",
  "project": "earnings-alerts",
  "config": {
    "browser_test_categories": [],
    "auto_verify": true,
    "max_verify_retries": 2
  },
  "features": [
    {
      "id": 1,
      "name": "project-init",
      "description": "Initialize Node.js/TypeScript project with dependencies",
      "category": "setup",
      "priority": 1,
      "task": {
        "files": ["package.json", "tsconfig.json"],
        "action": "Create package.json with TypeScript, ts-node, dotenv. Configure tsconfig for Node.js",
        "verify": "npm run build",
        "done": "Project compiles with tsc"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "npm install + npm run build verified. dist/ folder created with compiled JS."
    },
    {
      "id": 2,
      "name": "env-config",
      "description": "Create .env template with Google/Gmail credentials",
      "category": "setup",
      "priority": 1,
      "task": {
        "files": [".env.example", ".gitignore"],
        "action": "Create .env.example with GOOGLE_SHEET_ID, GOOGLE_CREDENTIALS_PATH, GMAIL_CREDENTIALS_PATH. Add .env to .gitignore",
        "verify": "cat .env.example",
        "done": ".env.example exists with all required variables"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "Created .env.example with GOOGLE_SHEET_ID, GOOGLE_CREDENTIALS_PATH, SHEET_NAME, LOG_LEVEL. .gitignore already had .env entries."
    },
    {
      "id": 3,
      "name": "google-auth-setup",
      "description": "Configure Google API auth (reuse trump-etf google_utils)",
      "category": "setup",
      "priority": 1,
      "task": {
        "files": ["src/google-auth.ts"],
        "action": "Port google_utils.py auth pattern to TypeScript or copy Python file. Use service account or OAuth credentials",
        "verify": "npm run build",
        "done": "Can authenticate with Google APIs"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "Created src/google-auth.ts with service account + OAuth support. Exports getAuthClient(), getSheetsService(), getGmailService(). Compiles successfully."
    },
    {
      "id": 4,
      "name": "project-structure",
      "description": "Create folder structure: src/, config/, data/, scripts/",
      "category": "setup",
      "priority": 1,
      "task": {
        "files": ["src/", "config/", "data/", "scripts/"],
        "action": "Create directory structure and placeholder files",
        "verify": "ls -la src config data scripts",
        "done": "All directories exist"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "All directories exist. Added config/recipients.json, config/settings.json as placeholder configs."
    },
    {
      "id": 5,
      "name": "read-google-sheet",
      "description": "Function to read earnings data from Google Sheet",
      "category": "data",
      "priority": 2,
      "task": {
        "files": ["src/sheets.ts"],
        "action": "Create function to read all rows from configured Google Sheet using Sheets API",
        "verify": "npm run build",
        "done": "Can fetch data from Google Sheet"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "Created src/sheets.ts with readRawSheetData() function. Reads sheet ID from GOOGLE_SHEET_ID env var, sheet name from SHEET_NAME env var (defaults to 'Earnings'). Uses getSheetsService() from google-auth.ts."
    },
    {
      "id": 6,
      "name": "parse-earnings-data",
      "description": "Parse sheet rows into typed EarningsReport objects",
      "category": "data",
      "priority": 2,
      "task": {
        "files": ["src/types.ts", "src/sheets.ts"],
        "action": "Define EarningsReport type with ticker, company, report_date, time_of_day. Parse raw sheet data into typed objects",
        "verify": "npm run build",
        "done": "Sheet data parsed into typed objects"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "parseRow() and parseDate() functions convert raw sheet data to EarningsReport objects. Handles multiple date formats. parseTimeOfDay() maps time strings to TimeOfDay enum (premarket/postmarket/unknown)."
    },
    {
      "id": 7,
      "name": "validate-data",
      "description": "Validate required fields, handle missing/malformed data",
      "category": "data",
      "priority": 2,
      "task": {
        "files": ["src/sheets.ts"],
        "action": "Add validation for required fields. Log warnings for malformed rows, skip them gracefully",
        "verify": "npm run build",
        "done": "Invalid rows logged and skipped"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "validateRow() checks required fields (ticker, report_date). Logs warnings for missing company names. Invalid rows are logged with [SKIP] prefix and excluded from results. SheetReadResult includes statistics."
    },
    {
      "id": 8,
      "name": "nyse-calendar",
      "description": "Get NYSE trading days (use exchange_calendars like trump-etf)",
      "category": "calendar",
      "priority": 2,
      "task": {
        "files": ["src/calendar.ts"],
        "action": "Integrate exchange_calendars (Python) or find TypeScript equivalent. Get NYSE trading schedule",
        "verify": "npm run build",
        "done": "Can query NYSE trading calendar"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "Implemented using hardcoded NYSE holidays for 2025-2026. Uses date-fns for date operations. Holidays verified against NYSE official calendar. getNYSEHolidays() exports full list."
    },
    {
      "id": 9,
      "name": "is-trading-day",
      "description": "Check if a given date is a trading day",
      "category": "calendar",
      "priority": 2,
      "task": {
        "files": ["src/calendar.ts"],
        "action": "Create isTradingDay(date) function that checks NYSE calendar",
        "verify": "npm run build",
        "done": "Function returns true/false for any date"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "isTradingDay(date: Date): boolean - returns false for weekends and NYSE holidays, true otherwise. Uses UTC for timezone consistency."
    },
    {
      "id": 10,
      "name": "trading-days-until",
      "description": "Calculate trading days between two dates",
      "category": "calendar",
      "priority": 2,
      "task": {
        "files": ["src/calendar.ts"],
        "action": "Create tradingDaysUntil(fromDate, toDate) function",
        "verify": "npm run build",
        "done": "Function counts trading days correctly"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "tradingDaysUntil(from: Date, to: Date): number - counts trading days, supports negative values if to<from. Also added getPreviousTradingDay(), getNextTradingDay(), getTradingDayOnOrBefore(), getTradingDayOnOrAfter(), getTradingDaysInRange()."
    },
    {
      "id": 11,
      "name": "determine-alert-date",
      "description": "Calculate alert date based on report time (premarket/post/specific/unknown)",
      "category": "alerts",
      "priority": 3,
      "task": {
        "files": ["src/alerts.ts"],
        "action": "Implement logic: post-market=same day, premarket/unknown=day before, specific time uses 5am-9:30am (pre) and 4pm-8pm (post) ranges",
        "verify": "npm run build",
        "done": "Alert dates calculated correctly for all time types"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "determineAlertDate() and determineAlertDateWithOffset() functions. Postmarket=same day morning, premarket/unknown=previous trading day. Uses calendar.ts for trading day calculations."
    },
    {
      "id": 12,
      "name": "find-due-alerts",
      "description": "Find all reports that need alerts TODAY",
      "category": "alerts",
      "priority": 3,
      "task": {
        "files": ["src/alerts.ts"],
        "action": "Filter earnings list to find reports whose alert date is today",
        "verify": "npm run build",
        "done": "Returns list of reports needing alerts"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "findDueAlerts(reports, today, alertDaysBefore?) filters reports to those due today. findAlertsDueToday() convenience function uses current date. Returns AlertDue[] sorted by report date."
    },
    {
      "id": 13,
      "name": "time-of-day-parser",
      "description": "Parse time strings (5:00am-9:30am=premarket, 4:00pm-8:00pm=post)",
      "category": "alerts",
      "priority": 3,
      "task": {
        "files": ["src/alerts.ts"],
        "action": "Parse various time formats to determine premarket vs post-market. Handle edge cases",
        "verify": "npm run build",
        "done": "Time strings correctly categorized"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "parseTimeOfDay() handles: named (premarket/BMO/AMC/post), time with period (6:00am/4:30pm), 24h format (16:00/0530). categorizeTime() maps hours to pre/post ranges."
    },
    {
      "id": 14,
      "name": "alert-deduplication",
      "description": "Track sent alerts to prevent duplicates (simple JSON file)",
      "category": "alerts",
      "priority": 3,
      "task": {
        "files": ["src/alerts.ts", "data/sent-alerts.json"],
        "action": "Before sending, check if alert already sent for this ticker+date. Save sent alerts to JSON file",
        "verify": "npm run build",
        "done": "No duplicate alerts sent"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "loadSentAlerts(), saveSentAlerts(), hasAlertBeenSent(ticker, reportDate), markAlertSent(). Stores in data/sent-alerts.json. filterUnsentAlerts() and cleanupOldAlerts(daysToKeep) utilities included."
    },
    {
      "id": 15,
      "name": "gmail-send",
      "description": "Send email via Gmail API (reuse trump-etf pattern)",
      "category": "email",
      "priority": 3,
      "task": {
        "files": ["src/email.ts"],
        "action": "Port Gmail sending from trump-etf. Use OAuth or service account",
        "verify": "npm run build",
        "done": "Can send test email"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "sendEmail(to[], subject, htmlBody, dryRun) sends via Gmail API. Uses base64-encoded RFC 2822 messages. Supports dry-run mode. Error handling for auth/permission issues."
    },
    {
      "id": 16,
      "name": "email-template",
      "description": "HTML email template with earnings list",
      "category": "email",
      "priority": 3,
      "task": {
        "files": ["src/email.ts"],
        "action": "Create HTML template showing: date, list of companies reporting, time of day for each",
        "verify": "npm run build",
        "done": "Email renders nicely with earnings data"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "formatAlertEmail(alerts) returns {subject, html}. Subject like 'Earnings Alert: 5 companies reporting tomorrow'. HTML table with Ticker, Company, Report Date, Time columns. Clean styling with blue header."
    },
    {
      "id": 17,
      "name": "recipient-config",
      "description": "Config file with email recipient list",
      "category": "email",
      "priority": 3,
      "task": {
        "files": ["config/recipients.json"],
        "action": "Create JSON config with array of email addresses",
        "verify": "cat config/recipients.json",
        "done": "Recipients configurable without code changes"
      },
      "status": "complete",
      "test_status": "passed",
      "test_method": "manual",
      "last_tested": "2026-01-25",
      "commits": [],
      "notes": "getRecipients() loads from config/recipients.json. Supports enabled flag to disable emails. Validates email format. Config already existed with placeholder structure."
    },
    {
      "id": 18,
      "name": "main-cli",
      "description": "Main entry point with CLI args (--check-trading-day, --dry-run)",
      "category": "main",
      "priority": 4,
      "task": {
        "files": ["src/main.ts"],
        "action": "Create CLI with args: --check-trading-day (skip non-trading days), --dry-run (show what would be sent), --verbose",
        "verify": "npx ts-node src/main.ts --help",
        "done": "CLI args working"
      },
      "status": "pending",
      "test_status": null,
      "test_method": null,
      "last_tested": null,
      "commits": [],
      "notes": ""
    },
    {
      "id": 19,
      "name": "daily-check",
      "description": "Orchestrate: read sheet → find due alerts → send email",
      "category": "main",
      "priority": 4,
      "task": {
        "files": ["src/main.ts"],
        "action": "Wire together all components: fetch sheet, find due alerts, format email, send to recipients",
        "verify": "npx ts-node src/main.ts --dry-run",
        "done": "End-to-end flow works"
      },
      "status": "pending",
      "test_status": null,
      "test_method": null,
      "last_tested": null,
      "commits": [],
      "notes": ""
    },
    {
      "id": 20,
      "name": "windows-task-setup",
      "description": "Batch scripts + setup_tasks.bat (like trump-etf)",
      "category": "scheduling",
      "priority": 5,
      "task": {
        "files": ["scripts/setup_tasks.bat", "scripts/setup_tasks.ps1"],
        "action": "Create Windows Task Scheduler setup scripts. Schedule daily run at 6am",
        "verify": "cat scripts/setup_tasks.bat",
        "done": "Task scheduler scripts ready"
      },
      "status": "pending",
      "test_status": null,
      "test_method": null,
      "last_tested": null,
      "commits": [],
      "notes": "Reference: ~/projects/trump-etf-tracker/setup_tasks.bat"
    },
    {
      "id": 21,
      "name": "github-actions-workflow",
      "description": ".github/workflows/daily-check.yml with cron schedule",
      "category": "scheduling",
      "priority": 5,
      "task": {
        "files": [".github/workflows/daily-check.yml"],
        "action": "Create GitHub Actions workflow: cron at 6am EST weekdays, manual trigger, secrets for credentials",
        "verify": "cat .github/workflows/daily-check.yml",
        "done": "Workflow file valid"
      },
      "status": "pending",
      "test_status": null,
      "test_method": null,
      "last_tested": null,
      "commits": [],
      "notes": ""
    },
    {
      "id": 22,
      "name": "run-scripts",
      "description": "run.bat wrapper with logging",
      "category": "scheduling",
      "priority": 5,
      "task": {
        "files": ["scripts/run.bat"],
        "action": "Create wrapper script that logs output to data/run_YYYYMMDD.log",
        "verify": "cat scripts/run.bat",
        "done": "Run script with logging ready"
      },
      "status": "pending",
      "test_status": null,
      "test_method": null,
      "last_tested": null,
      "commits": [],
      "notes": "Reference: ~/projects/trump-etf-tracker/run.bat"
    }
  ]
}
